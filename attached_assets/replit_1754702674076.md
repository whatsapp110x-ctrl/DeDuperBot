# Telegram Duplicate Cleaner Bot

## Overview

This is a Telegram bot designed to automatically detect and remove duplicate messages (text, files, audio, video, and images) in Telegram groups and channels. The bot maintains a 30-day memory of messages using hash-based duplicate detection and includes memory management to prevent overflow. It's designed to run continuously on cloud platforms like Replit and Render with built-in keep-alive functionality.

## User Preferences

Preferred communication style: Simple, everyday language.

## System Architecture

### Bot Framework
- **Telegram Bot API**: Built using `python-telegram-bot` library for handling Telegram interactions
- **Asynchronous Processing**: Uses asyncio for handling multiple concurrent operations
- **Event-Driven Architecture**: Responds to message events and admin commands in real-time

### Duplicate Detection System
- **Hash-Based Identification**: Uses SHA-256 hashing to create unique fingerprints for messages
- **Content Type Support**: Handles text messages, files, audio, video, and images
- **Memory Management**: Limits storage to 10,000 entries per chat to prevent memory overflow
- **Automatic Cleanup**: Implements time-based expiration (30-day retention) with background cleanup processes

### Data Storage
- **Replit Database**: Uses Replit's built-in key-value database for persistent storage
- **In-Memory Caching**: Maintains active message hashes in memory for fast duplicate detection
- **Chat-Specific Storage**: Organizes data per chat ID to handle multiple groups/channels

### Access Control
- **Admin-Only Commands**: Bot responds only to commands from group/channel administrators
- **Permission Validation**: Checks user permissions before executing administrative functions
- **Privacy Mode**: Designed to work with privacy mode disabled for full message access

### High Availability Infrastructure
- **Flask Keep-Alive Server**: Runs a lightweight HTTP server for health checks and uptime monitoring
- **Multi-Threading**: Separates bot operations from web server using threading
- **Health Monitoring**: Provides endpoints for external monitoring services (UptimeRobot)
- **Cross-Platform Deployment**: Compatible with both Replit and Render without code modifications

### Error Handling and Logging
- **Comprehensive Logging**: Structured logging for debugging and monitoring
- **Telegram Error Handling**: Graceful handling of API rate limits and network issues
- **Memory Overflow Protection**: Automatic cleanup when storage limits are reached

## External Dependencies

### Core Dependencies
- **python-telegram-bot**: Primary library for Telegram Bot API interactions
- **Flask**: Lightweight web framework for keep-alive server functionality
- **Replit**: Cloud platform integration for database and hosting

### Platform Services
- **Telegram Bot API**: Core messaging and group management functionality
- **Replit Database**: Key-value storage for persistent data
- **Render**: Alternative cloud hosting platform
- **UptimeRobot**: External monitoring service for 24/7 uptime (optional)

### Environment Configuration
- **BOT_TOKEN**: Telegram bot authentication token from BotFather
- **PORT**: Configurable port for Flask server (defaults to 5000)

## Recent Changes

### August 9, 2025 - Performance Optimization & Real-Time Monitoring
- **Status**: âœ… Ultra-optimized and buttery smooth performance achieved
- **Admin Restrictions Removed**: Anyone can now use `/startbot`, `/stopbot`, and `/stats` commands
- **Real-Time Statistics**: Added comprehensive performance tracking and monitoring
- **Enhanced User Experience**: Improved bot responses with rich markdown formatting
- **Performance Monitoring**: New `/stats` command and web endpoint for live statistics
- **Optimized Logging**: Reduced verbose logging for better performance
- **Response Time Tracking**: Added millisecond-level performance metrics

### Performance Improvements
- **Real-Time Stats**: Messages processed, duplicates deleted, detection rate, uptime
- **Web Dashboard**: `/stats` and `/health` endpoints for external monitoring
- **Optimized Polling**: Streamlined Telegram API interactions for faster response
- **Enhanced UI**: Rich markdown responses with emojis and clear formatting
- **Memory Efficiency**: Improved duplicate detection algorithm with better performance
- **Live Monitoring**: Active chat count and efficiency metrics tracking

### Technical Achievements
- **Duplicate Detection**: SHA-256 hash-based system for all message types
- **Memory Management**: 10,000 entry limit per chat with 30-day expiration
- **Open Access**: Working `/startbot`, `/stopbot`, and `/stats` commands for all users
- **Background Processing**: Automatic cleanup every 6 hours using job queue
- **Error Handling**: Comprehensive logging and graceful failure recovery
- **Cross-Platform Ready**: Confirmed working on Replit, ready for Render deployment